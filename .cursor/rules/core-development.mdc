---
description: ALWAYS for coding tasks. Especially multi-file features: spec → repo map → vertical slices. Minimal diffs. Tests/verification required. No unrelated refactors.
globs: ["**/*"]
alwaysApply: true
---

# When to apply
Apply to any coding request. If the request spans multiple files or is ambiguous, enforce the workflow below.

# Workflow (mandatory)
1) Spec first (no code):
- Goal, non-goals, constraints
- Acceptance criteria
- Test plan (what proves it works)

2) Repo map second (no code):
- Entry points + files likely to change (with reasons)
- Current flow relevant to the feature
- Contracts to lock (DTOs/interfaces/errors)

3) Implement in vertical slices:
- Propose slices; pick the smallest end-to-end slice
- Implement ONE slice per change-set

# Scope limits (anti-getting-lost)
- Max 5 files per slice. If more: split into smaller slices.
- No unrelated renames/reformatting/cleanup.
- If context is missing: ask for the smallest relevant snippets (paths + relevant sections), do not guess.

# Output format (mandatory)
## Working Memory
- Feature:
- Current slice:
- Decisions locked:
- In-scope files:
- Open questions:

## Plan (≤5 bullets)

## Changeset
- Files to change (intent per file)
- Patch/diff per file

## Tests & Verification
- Tests to add/update
- Commands to run
- Checklist of acceptance criteria